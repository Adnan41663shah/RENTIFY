<link rel="stylesheet" href="/css/myListing.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">

<div class="listings-container mt-3">
  <h1 class="ms-3">My Properties</h1>
  <% if(listings.length == 0){ %>
    <div class="text-center p-5 bg-light rounded shadow-sm">
      <h4 class="mb-3">No Properties yet, click to add...</h4>
      <a class="upload-btn d-block" href="/listings/new"><i class="fa-solid fa-table-list me-2"></i>List Your Property</a>
    </div>  
  <% }else{ %>
    <a class="upload-btn" href="/listings/new"><i class="fa-solid fa-table-list"></i>Add New Property</a>
    <% for(let listing of listings) { %>
    <div class="d-flex ED-container">
          <a href="/listings/<%= listing._id %>/edit" class="btn">Edit</a>
          <form action="/listings/<%= listing._id %>?_method=DELETE" method="POST">
            <button class="btn">Delete</button>
          </form>
    </div>

    <div class="listing-card">
      <a href="/listings/<%= listing._id %>" class="listing-content">

        <!-- Image Section -->
        <div class="listing-image">
          <% 
            const _img0 = (listing.images && listing.images.length) ? listing.images[0] : null;
            const _img0Url = _img0 ? (typeof _img0 === 'string' ? _img0 : (_img0.url || _img0.secure_url || _img0.path)) : null;
            const _single = listing.image || null;
            const _singleUrl = _single ? (typeof _single === 'string' ? _single : (_single.url || _single.secure_url || _single.path)) : null;
            const myListImg = listing.displayUrl || _img0Url || _singleUrl || '/assets/rentifylogo2.png';
          %>
          <img src="<%= myListImg %>" alt="listing_img" onerror="this.src='/assets/rentifylogo2.png'">
          <div class="wishlist">
            <i class="fa-solid fa-heart wishlist-icon" data-listing-id="<%= listing._id %>"></i>
          </div>
        </div>

        <!-- Details Section -->
        <div class="listing-details">
          <h5 class="listing-title"><%= listing.title %></h5>
          <p class="listing-location"><i class="fa-solid fa-location-dot"></i> <%= listing.location %>, <%= listing.country %></p>
          <p class="listing-price"><b>&#x20B9;<%= listing.price.toLocaleString("en-IN") %></b> / Day</p>
        </div>

      </a>
    </div>
  <% } }%>
</div>
<script src="/js/wishlist.js"></script>
<script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
